function BoBo(){this._init.apply(this,arguments)}BoBo.prototype=function(){return{_init:function(a,b){return this.imgSrc=a,this.container=document.getElementById(b),this.container?(this.shakeAngle=0,this.shakeRange=.45,this.shakeAngleSpeed=.65,this.shakeAngleDelay=1,this.interval=40,this.controlRects=[],void 0):(alert("canvas\u5bb9\u5668\u4e0d\u5b58\u5728\uff01"),void 0)},_getPointRGB:function(a,b){a=Math.floor(a),b=Math.floor(b);var c=this.imageData.data,d=[],e=4*(b*this.canvasWidth+a);for(i=e;e+3>i;i++)d.push(c[i]);return d},_setRectPointRGB:function(a,b,c,d){b=Math.floor(b),c=Math.floor(c);var e=this.rectImageData[a],f=this.controlRects[a],g=f.width,b=b-f.x,c=c-f.y,h=4*(c*g+b);e.data[h]=d[0],e.data[h+1]=d[1],e.data[h+2]=d[2],e.data[h+3]=255},_makeRectShake:function(a,b){for(var c=this.controlRects[a],d=.5*c.width,e=.5*c.height,f={x:c.x+d,y:c.y+e},g=2*Math.PI,h=Math.PI/(2*(d+e)),i=0;g>i;i+=h)for(var j={x:d*Math.cos(i),y:e*Math.sin(i)},k={x:b.x-f.x,y:b.y-f.y},l={x:j.x-k.x,y:j.y-k.y},m=1/Math.max(Math.abs(l.x),Math.abs(l.y)),n=0;1>=n;n=Math.min(1,n+m)){var o=j.x*n,p=j.y*n,q=l.x*n,r=l.y*n;o+=f.x,p+=f.y,q+=b.x,r+=b.y;var s=this._getPointRGB(o,p);if(this._setRectPointRGB(a,q,r,s),1==n)break}},_makeShake:function(){for(var a=this.controlRects.length,b=0;a>b;b++){var c=this.controlRects[b],d=.5*c.width,e=.5*c.height,f={x:c.x+d,y:c.y+e},g=d*this.shakeRange,h=e*this.shakeRange,i={x:f.x+Math.sin(this.shakeAngle)*g,y:f.y+Math.cos(this.shakeAngle)*h};this._makeRectShake(b,i)}this.shakeAngle+=this.shakeAngleSpeed,this.shakeAngle>360&&(this.shakeAngle-=360),this.shakeAngleSpeed*=this.shakeAngleDelay},_getRectImageData:function(){this.rectImageData=[];for(var a=0;a<this.controlRects.length;a++){var b=this.controlRects[a],c=this.canvasContext.getImageData(b.x,b.y,b.width,b.height);this.rectImageData.push(c)}},_putRectImageData:function(){for(var a=0;a<this.controlRects.length;a++){var b=this.controlRects[a],c=this.rectImageData[a];this.canvasContext.putImageData(c,b.x,b.y)}},_showDebug:function(){var a=this,b=document.getElementById("avg");this.totalTimes=0,this.totalTime=0,setInterval(function(){b.innerHTML=a.totalTimes<=0?"\u672a\u8fd0\u884c":a.totalTimes+"\u5e27/\u79d2\uff1b"+parseInt(a.totalTime/a.totalTimes)+"ms/\u5e27",a.totalTimes=0,a.totalTime=0},1e3)},_run:function(){var a=this;this._timer=this._debug?setInterval(function(){a.totalTimes++;var b=new Date;a._getRectImageData(),a._makeShake(),a._putRectImageData(),a.totalTime+=new Date-b},this.interval):setInterval(function(){a._getRectImageData(),a._makeShake(),a._putRectImageData()},this.interval)},addControl:function(a){this.controlRects.push(a)},start:function(){var a=this;if(!this.controlRects.length)return alert("\u56fe\u7247\u6ca1\u6709\u4efb\u4f55\u63a7\u5236\u70b9\uff01"),void 0;if(this._inited)a._run();else{var b=new Image;b.onload=function(){var c=b.width,d=b.height,e=document.createElement("canvas"),f=e.getContext("2d");e.width=c,e.height=d,f.drawImage(b,0,0),a.container.appendChild(e),a.canvasWidth=c,a.canvasHeight=d,a.canvasContext=f,a.imageData=f.getImageData(0,0,c,d),a._inited=!0,a._run()},b.src=this.imgSrc,this._debug&&this._showDebug()}},reset:function(){this.stop(),this.canvasContext.putImageData(this.imageData,0,0)},stop:function(){clearInterval(this._timer)}}}();