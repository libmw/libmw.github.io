function createControl(e){return $('<div class="control" style="left:'+e.x+"px;top:"+e.y+"px;width:"+e.width+"px;height:"+e.height+'px"><div class="resize"></div></div>')}function showControls(){var e=bobo.container;for(var t=0;t<bobo.controlRects.length;t++){var n=bobo.controlRects[t];createControl(n).appendTo($(e))}}function updateControlSizeOrPos(){if(!currentTouchEl||isCancel)return;var e=currentTouchEl,t=parseInt(e.data("delta-x")),n=parseInt(e.data("delta-y"));if(!isResize){var r=e.data("left")+t,i=e.data("top")+n;i=Math.max(i,0),i=Math.min(bobo.canvasHeight-e.data("height"),i),r=Math.max(r,0),r=Math.min(bobo.canvasWidth-e.data("width"),r),e.css("left",r||0),e.css("top",i||0)}else{var s=e.data("width")+t,o=e.data("height")+n;s=Math.max(s,20),s=Math.min(bobo.canvasWidth-e.data("left"),s),o=Math.max(o,20),o=Math.min(bobo.canvasHeight-e.data("top"),o),e.css("width",s||0),e.css("height",o||0)}webkitRequestAnimationFrame(updateControlSizeOrPos)}bobo.start();var currentTouchEl=null,isResize=!1,isCancel=!0,Event={touchStart:"touchstart",touchMove:"touchmove",touchEnd:"touchend",touchCancel:"touchcancel"};"ontouchend"in document||(Event={touchStart:"mousedown",touchMove:"mousemove",touchEnd:"mouseup",touchCancel:"mouseup"}),$("#toolbar .cmd").on(Event.touchStart,function(){var e=this;e.style.backgroundColor="#333",setTimeout(function(){e.style.backgroundColor=""},250)}),$("#toolbar .edit").on(Event.touchStart,function(){bobo.reset(),showControls(),$("#toolbar").attr("class","edit")}),$("#toolbar .cancel").on(Event.touchStart,function(){$("#cont .control").remove(),$("#toolbar").attr("class","normal"),bobo.start()}),$("#toolbar .add").on(Event.touchStart,function(){if($("#cont .control").length>=5){alert("\u6700\u591a\u53ea\u80fd\u6dfb\u52a0 5 \u4e2a\u63a7\u5236\u70b9\u54e6~");return}var e=bobo.container,t=60,n=60,r=bobo.canvasWidth-t,i=bobo.canvasHeight-n,s={x:parseInt(Math.random()*r),y:parseInt(Math.random()*i),width:t,height:n};createControl(s).appendTo($(e))}),$("#toolbar .del").on(Event.touchStart,function(){if(!currentTouchEl)return;currentTouchEl.remove()}),$("#toolbar .play").on(Event.touchStart,function(){bobo.controlRects=[],$("#cont .control").each(function(){var e=$(this);bobo.addControl({x:parseInt(e.css("left")),y:parseInt(e.css("top")),width:parseInt(e.css("width")),height:parseInt(e.css("height"))})}),$("#cont .control").remove(),bobo.start(),$("#toolbar").attr("class","normal")}),$("#cont").delegate(".control",Event.touchStart,function(e){currentTouchEl&&currentTouchEl[0]!=this&&(currentTouchEl.attr("class","control"),currentTouchEl=null),currentTouchEl=$(this).attr("class","control selected")}).delegate(".resize",Event.touchStart,function(e){isResize=!0}),$(document.body).on(Event.touchStart,function(e){if(!currentTouchEl)return;var t=e.pageX||e.touches[0].pageX,n=e.pageY||e.touches[0].pageY,r=currentTouchEl;r.data("touch-x",t).data("touch-y",n),r.data("left",parseInt(r.css("left"))),r.data("top",parseInt(r.css("top"))),r.data("width",parseInt(r.css("width"))),r.data("height",parseInt(r.css("height"))),r.data("delta-x",0),r.data("delta-y",0),isCancel=!1,updateControlSizeOrPos()}),$(document.body).on(Event.touchMove,function(e){e.preventDefault();if(!currentTouchEl||isCancel)return;var t=currentTouchEl,n=(e.pageX||e.touches[0].pageX)-t.data("touch-x"),r=(e.pageY||e.touches[0].pageY)-t.data("touch-y");t.data("delta-x",n),t.data("delta-y",r)}),$(document.body).on(Event.touchEnd+" "+Event.touchCancel,function(){isResize=!1,isCancel=!0,webkitCancelAnimationFrame(updateControlSizeOrPos)})